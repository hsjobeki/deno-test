import { validateFunction, validateInteger, validateString, } from "../validators.mjs";
import { ERR_INVALID_ARG_TYPE, ERR_OUT_OF_RANGE, hideStackFrames, } from "../errors.ts";
import { toBuf, validateByteSource } from "./util.ts";
import { createSecretKey, isKeyObject } from "./keys.ts";
import { kMaxLength } from "../buffer.mjs";
import { isAnyArrayBuffer, isArrayBufferView } from "../util/types.ts";
import { notImplemented } from "../../_utils.ts";
const validateParameters = hideStackFrames((hash, key, salt, info, length) => {
    key = prepareKey(key);
    salt = toBuf(salt);
    info = toBuf(info);
    validateString(hash, "digest");
    validateByteSource(salt, "salt");
    validateByteSource(info, "info");
    validateInteger(length, "length", 0, kMaxLength);
    if (info.byteLength > 1024) {
        throw new ERR_OUT_OF_RANGE("info", "must not contain more than 1024 bytes", info.byteLength);
    }
    return {
        hash,
        key,
        salt,
        info,
        length,
    };
});
function prepareKey(key) {
    if (isKeyObject(key)) {
        return key;
    }
    if (isAnyArrayBuffer(key)) {
        return createSecretKey(new Uint8Array(key));
    }
    key = toBuf(key);
    if (!isArrayBufferView(key)) {
        throw new ERR_INVALID_ARG_TYPE("ikm", [
            "string",
            "SecretKeyObject",
            "ArrayBuffer",
            "TypedArray",
            "DataView",
            "Buffer",
        ], key);
    }
    return createSecretKey(key);
}
export function hkdf(hash, key, salt, info, length, callback) {
    ({ hash, key, salt, info, length } = validateParameters(hash, key, salt, info, length));
    validateFunction(callback, "callback");
    notImplemented("crypto.hkdf");
}
export function hkdfSync(hash, key, salt, info, length) {
    ({ hash, key, salt, info, length } = validateParameters(hash, key, salt, info, length));
    notImplemented("crypto.hkdfSync");
}
export default {
    hkdf,
    hkdfSync,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGtkZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhrZGYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixlQUFlLEVBQ2YsY0FBYyxHQUNmLE1BQU0sbUJBQW1CLENBQUM7QUFDM0IsT0FBTyxFQUNMLG9CQUFvQixFQUNwQixnQkFBZ0IsRUFDaEIsZUFBZSxHQUNoQixNQUFNLGNBQWMsQ0FBQztBQUN0QixPQUFPLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3RELE9BQU8sRUFBRSxlQUFlLEVBQUUsV0FBVyxFQUFhLE1BQU0sV0FBVyxDQUFDO0FBRXBFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRWpELE1BQU0sa0JBQWtCLEdBQUcsZUFBZSxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxFQUFFO0lBQzNFLEdBQUcsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdEIsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQixJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRW5CLGNBQWMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDL0Isa0JBQWtCLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLGtCQUFrQixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUVqQyxlQUFlLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFFakQsSUFBSSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksRUFBRTtRQUMxQixNQUFNLElBQUksZ0JBQWdCLENBQ3hCLE1BQU0sRUFDTix1Q0FBdUMsRUFDdkMsSUFBSSxDQUFDLFVBQVUsQ0FDaEIsQ0FBQztLQUNIO0lBRUQsT0FBTztRQUNMLElBQUk7UUFDSixHQUFHO1FBQ0gsSUFBSTtRQUNKLElBQUk7UUFDSixNQUFNO0tBQ1AsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxVQUFVLENBQUMsR0FBMkI7SUFDN0MsSUFBSSxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDcEIsT0FBTyxHQUFHLENBQUM7S0FDWjtJQUVELElBQUksZ0JBQWdCLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDekIsT0FBTyxlQUFlLENBQUMsSUFBSSxVQUFVLENBQUMsR0FBaUMsQ0FBQyxDQUFDLENBQUM7S0FDM0U7SUFFRCxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQWEsQ0FBQyxDQUFDO0lBRTNCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUMzQixNQUFNLElBQUksb0JBQW9CLENBQzVCLEtBQUssRUFDTDtZQUNFLFFBQVE7WUFDUixpQkFBaUI7WUFDakIsYUFBYTtZQUNiLFlBQVk7WUFDWixVQUFVO1lBQ1YsUUFBUTtTQUNULEVBQ0QsR0FBRyxDQUNKLENBQUM7S0FDSDtJQUVELE9BQU8sZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzlCLENBQUM7QUFFRCxNQUFNLFVBQVUsSUFBSSxDQUNsQixJQUFZLEVBQ1osR0FBMkIsRUFDM0IsSUFBZ0IsRUFDaEIsSUFBZ0IsRUFDaEIsTUFBYyxFQUNkLFFBQThEO0lBRTlELENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsa0JBQWtCLENBQ3JELElBQUksRUFDSixHQUFHLEVBQ0gsSUFBSSxFQUNKLElBQUksRUFDSixNQUFNLENBQ1AsQ0FBQyxDQUFDO0lBRUgsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRXZDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FDdEIsSUFBWSxFQUNaLEdBQTJCLEVBQzNCLElBQWdCLEVBQ2hCLElBQWdCLEVBQ2hCLE1BQWM7SUFFZCxDQUFDLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxHQUFHLGtCQUFrQixDQUNyRCxJQUFJLEVBQ0osR0FBRyxFQUNILElBQUksRUFDSixJQUFJLEVBQ0osTUFBTSxDQUNQLENBQUMsQ0FBQztJQUVILGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQ3BDLENBQUM7QUFFRCxlQUFlO0lBQ2IsSUFBSTtJQUNKLFFBQVE7Q0FDVCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiB0aGUgRGVubyBhdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBNSVQgbGljZW5zZS5cbi8vIENvcHlyaWdodCBKb3llbnQsIEluYy4gYW5kIE5vZGUuanMgY29udHJpYnV0b3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBNSVQgbGljZW5zZS5cblxuaW1wb3J0IHtcbiAgdmFsaWRhdGVGdW5jdGlvbixcbiAgdmFsaWRhdGVJbnRlZ2VyLFxuICB2YWxpZGF0ZVN0cmluZyxcbn0gZnJvbSBcIi4uL3ZhbGlkYXRvcnMubWpzXCI7XG5pbXBvcnQge1xuICBFUlJfSU5WQUxJRF9BUkdfVFlQRSxcbiAgRVJSX09VVF9PRl9SQU5HRSxcbiAgaGlkZVN0YWNrRnJhbWVzLFxufSBmcm9tIFwiLi4vZXJyb3JzLnRzXCI7XG5pbXBvcnQgeyB0b0J1ZiwgdmFsaWRhdGVCeXRlU291cmNlIH0gZnJvbSBcIi4vdXRpbC50c1wiO1xuaW1wb3J0IHsgY3JlYXRlU2VjcmV0S2V5LCBpc0tleU9iamVjdCwgS2V5T2JqZWN0IH0gZnJvbSBcIi4va2V5cy50c1wiO1xuaW1wb3J0IHR5cGUgeyBCaW5hcnlMaWtlIH0gZnJvbSBcIi4vdHlwZXMudHNcIjtcbmltcG9ydCB7IGtNYXhMZW5ndGggfSBmcm9tIFwiLi4vYnVmZmVyLm1qc1wiO1xuaW1wb3J0IHsgaXNBbnlBcnJheUJ1ZmZlciwgaXNBcnJheUJ1ZmZlclZpZXcgfSBmcm9tIFwiLi4vdXRpbC90eXBlcy50c1wiO1xuaW1wb3J0IHsgbm90SW1wbGVtZW50ZWQgfSBmcm9tIFwiLi4vLi4vX3V0aWxzLnRzXCI7XG5cbmNvbnN0IHZhbGlkYXRlUGFyYW1ldGVycyA9IGhpZGVTdGFja0ZyYW1lcygoaGFzaCwga2V5LCBzYWx0LCBpbmZvLCBsZW5ndGgpID0+IHtcbiAga2V5ID0gcHJlcGFyZUtleShrZXkpO1xuICBzYWx0ID0gdG9CdWYoc2FsdCk7XG4gIGluZm8gPSB0b0J1ZihpbmZvKTtcblxuICB2YWxpZGF0ZVN0cmluZyhoYXNoLCBcImRpZ2VzdFwiKTtcbiAgdmFsaWRhdGVCeXRlU291cmNlKHNhbHQsIFwic2FsdFwiKTtcbiAgdmFsaWRhdGVCeXRlU291cmNlKGluZm8sIFwiaW5mb1wiKTtcblxuICB2YWxpZGF0ZUludGVnZXIobGVuZ3RoLCBcImxlbmd0aFwiLCAwLCBrTWF4TGVuZ3RoKTtcblxuICBpZiAoaW5mby5ieXRlTGVuZ3RoID4gMTAyNCkge1xuICAgIHRocm93IG5ldyBFUlJfT1VUX09GX1JBTkdFKFxuICAgICAgXCJpbmZvXCIsXG4gICAgICBcIm11c3Qgbm90IGNvbnRhaW4gbW9yZSB0aGFuIDEwMjQgYnl0ZXNcIixcbiAgICAgIGluZm8uYnl0ZUxlbmd0aCxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBoYXNoLFxuICAgIGtleSxcbiAgICBzYWx0LFxuICAgIGluZm8sXG4gICAgbGVuZ3RoLFxuICB9O1xufSk7XG5cbmZ1bmN0aW9uIHByZXBhcmVLZXkoa2V5OiBCaW5hcnlMaWtlIHwgS2V5T2JqZWN0KSB7XG4gIGlmIChpc0tleU9iamVjdChrZXkpKSB7XG4gICAgcmV0dXJuIGtleTtcbiAgfVxuXG4gIGlmIChpc0FueUFycmF5QnVmZmVyKGtleSkpIHtcbiAgICByZXR1cm4gY3JlYXRlU2VjcmV0S2V5KG5ldyBVaW50OEFycmF5KGtleSBhcyB1bmtub3duIGFzIEFycmF5QnVmZmVyTGlrZSkpO1xuICB9XG5cbiAga2V5ID0gdG9CdWYoa2V5IGFzIHN0cmluZyk7XG5cbiAgaWYgKCFpc0FycmF5QnVmZmVyVmlldyhrZXkpKSB7XG4gICAgdGhyb3cgbmV3IEVSUl9JTlZBTElEX0FSR19UWVBFKFxuICAgICAgXCJpa21cIixcbiAgICAgIFtcbiAgICAgICAgXCJzdHJpbmdcIixcbiAgICAgICAgXCJTZWNyZXRLZXlPYmplY3RcIixcbiAgICAgICAgXCJBcnJheUJ1ZmZlclwiLFxuICAgICAgICBcIlR5cGVkQXJyYXlcIixcbiAgICAgICAgXCJEYXRhVmlld1wiLFxuICAgICAgICBcIkJ1ZmZlclwiLFxuICAgICAgXSxcbiAgICAgIGtleSxcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIGNyZWF0ZVNlY3JldEtleShrZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGtkZihcbiAgaGFzaDogc3RyaW5nLFxuICBrZXk6IEJpbmFyeUxpa2UgfCBLZXlPYmplY3QsXG4gIHNhbHQ6IEJpbmFyeUxpa2UsXG4gIGluZm86IEJpbmFyeUxpa2UsXG4gIGxlbmd0aDogbnVtYmVyLFxuICBjYWxsYmFjazogKGVycjogRXJyb3IgfCBudWxsLCBkZXJpdmVkS2V5OiBBcnJheUJ1ZmZlcikgPT4gdm9pZCxcbikge1xuICAoeyBoYXNoLCBrZXksIHNhbHQsIGluZm8sIGxlbmd0aCB9ID0gdmFsaWRhdGVQYXJhbWV0ZXJzKFxuICAgIGhhc2gsXG4gICAga2V5LFxuICAgIHNhbHQsXG4gICAgaW5mbyxcbiAgICBsZW5ndGgsXG4gICkpO1xuXG4gIHZhbGlkYXRlRnVuY3Rpb24oY2FsbGJhY2ssIFwiY2FsbGJhY2tcIik7XG5cbiAgbm90SW1wbGVtZW50ZWQoXCJjcnlwdG8uaGtkZlwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhrZGZTeW5jKFxuICBoYXNoOiBzdHJpbmcsXG4gIGtleTogQmluYXJ5TGlrZSB8IEtleU9iamVjdCxcbiAgc2FsdDogQmluYXJ5TGlrZSxcbiAgaW5mbzogQmluYXJ5TGlrZSxcbiAgbGVuZ3RoOiBudW1iZXIsXG4pIHtcbiAgKHsgaGFzaCwga2V5LCBzYWx0LCBpbmZvLCBsZW5ndGggfSA9IHZhbGlkYXRlUGFyYW1ldGVycyhcbiAgICBoYXNoLFxuICAgIGtleSxcbiAgICBzYWx0LFxuICAgIGluZm8sXG4gICAgbGVuZ3RoLFxuICApKTtcblxuICBub3RJbXBsZW1lbnRlZChcImNyeXB0by5oa2RmU3luY1wiKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBoa2RmLFxuICBoa2RmU3luYyxcbn07XG4iXX0=